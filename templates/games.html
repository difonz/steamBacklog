{% extends "base.html" %}
{% block title %}Games{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1>My Game Library</h1>
</div>

<table class="table table-striped">
  <thead>
    <tr>
      {% for col, label in [('name','Name'), ('playtime','Playtime'), ('completion','Completion %'), ('status','Status')] %}
        {% set new_order = (request.args.sort == col and request.args.order == 'asc') ? 'desc' : 'asc' %}
        <th>
          <a href="?sort={{col}}&order={{new_order}}{% if request.args.tag %}&tag={{request.args.tag}}{% endif %}">
            {{ label }}
            {% if request.args.sort == col %}
              <small class="text-muted">{{ request.args.order == 'asc' and '▲' or '▼' }}</small>
            {% endif %}
          </a>
        </th>
      {% endfor %}
      <th>Change Status</th>
    </tr>
  </thead>
  <tbody>
    {% for g in games %}
      <tr>
        <td>{{ g.name }}</td>
        <td>{{ g.playtime }}</td>
        <td>{{ g.completion|default(0, true) }}%</td>
        <td>{{ g.status }}</td>
        <td>
          <form method="POST" action="{{ url_for('update_status', appid=g.appid) }}" class="form-inline">
            <select name="status" class="form-control form-control-sm mr-2">
              {% for option in ['Backlog','In Progress','Completed'] %}
                <option value="{{ option }}" {% if g.status == option %}selected{% endif %}>{{ option }}</option>
              {% endfor %}
            </select>
            <button type="submit" class="btn btn-sm btn-primary">Save</button>
          </form>
        </td>
      </tr>
    {% endfor %}
    {% if games|length == 0 %}
      <tr><td colspan="5" class="text-center">No games found.</td></tr>
    {% endif %}
  </tbody>
</table>

<nav aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    {% if page > 1 %}
      <li class="page-item"><a class="page-link" href="?page=1&sort={{sort}}&order={{order}}{{ tag and '&tag=' ~ tag }}">First</a></li>
      <li class="page-item"><a class="page-link" href="?page={{page-1}}&sort={{sort}}&order={{order}}{{ tag and '&tag=' ~ tag }}">Previous</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">First</span></li>
      <li class="page-item disabled"><span class="page-link">Previous</span></li>
    {% endif %}
    <li class="page-item active"><span class="page-link">Page {{ page }} of {{ total_pages }}</span></li>
    {% if page < total_pages %}
      <li class="page-item"><a class="page-link" href="?page={{page+1}}&sort={{sort}}&order={{order}}{{ tag and '&tag=' ~ tag }}">Next</a></li>
      <li class="page-item"><a class="page-link" href="?page={{total_pages}}&sort={{sort}}&order={{order}}{{ tag and '&tag=' ~ tag }}">Last</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Next</span></li>
      <li class="page-item disabled"><span class="page-link">Last</span></li>
    {% endif %}
  </ul>
</nav>
{% endblock %}
